<link rel="import" href="../entity.html">
<link rel="import" href="../socket-manager.html">
<link rel="import" href="./asteroid.html">
<link rel="import" href="../body-group.html">
<script>
    class AsteroidBelt extends Entity {
        constructor(scene, x, y, density = 4) {
            super(scene.ctx, { x, y });
            this.density = density;
            this.world = scene.world;

            this.asteroids = [];

            this.sizes = [10, 10, 10, 10, 10, 20, 30, 30, 30, 30, 60, 120];

            let cursorX = 0, cursorY = Math.random() * 50, size;

            while (cursorX < scene.width + 50) {
                size = this.sizes[Math.floor(Math.random() * this.sizes.length)];

                if (cursorY > Math.random() * 200 + 100) {
                    cursorY = Math.random() * 200;
                    cursorX += Math.random() * size * 2;
                }

                this.asteroids.push(new Asteroid(scene, x + cursorX, y + cursorY, {
                    size: size,
                    move: false,
                    rotate: true
                }));

                cursorY += (size * 2) + Math.random() * size;
                cursorX += Math.random() * (size / 2) + 10;
            }

            this.body = new BodyGroup(this.asteroids.map(a => a.body));
        }

        collisionCallback (other) {
            if (other instanceof Player) {
                other.hit(1);
            }
        }

        update(dt) {
            this.asteroids.forEach(a => a.update(dt));
        }

        render () {
            if (!Socket.isDriver) { return; }

            super.render();
            this.asteroids.forEach(a => a.render());
            super.afterRender();
        }
    }
</script>